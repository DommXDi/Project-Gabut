<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manajer Tugas Kuliah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "sans-serif"],
            },
          },
        },
      };
    </script>
    <style>
      /* Perbaikan untuk placeholder input date/time */
      input[type="date"]::before,
      input[type="time"]::before {
        content: attr(placeholder) !important;
        color: #9ca3af; /* text-gray-400 */
        margin-right: 0.5em;
      }
      input[type="date"]:focus::before,
      input[type="date"]:valid::before,
      input[type="time"]:focus::before,
      input[type="time"]:valid::before {
        content: "";
        display: none;
      }
    </style>
  </head>
  <body
    class="bg-white text-gray-900 dark:bg-gray-900 dark:text-white font-sans antialiased transition-colors duration-300"
  >
    <!-- Wrapper utama dengan padding bawah agar footer tidak menimpa -->
    <div class="container max-w-3xl mx-auto p-4 sm:p-8 pb-16">
      <header class="text-center mb-8 relative">
        <!-- 
          PERBAIKAN: 
          Menambahkan px-12 (padding kiri-kanan) 
          agar teks tidak mentok ke tombol di HP
        -->
        <h1 class="text-4xl font-bold text-blue-500 dark:text-blue-400 px-12">
          âŒ› Deadline Keeper
        </h1>
        <p class="text-lg text-gray-600 dark:text-gray-300 mt-2 px-4">
          Kerjain woy, biar ga lupa! :)
        </p>

        <!-- Tombol Theme Toggle (Tetap di pojok) -->
        <button
          id="theme-toggle"
          class="absolute top-0 right-0 p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
          title="Ganti Tema"
        >
          <svg
            id="theme-icon-moon"
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
            ></path>
          </svg>
          <svg
            id="theme-icon-sun"
            class="w-6 h-6 hidden"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M12 12a4 4 0 11-8 0 4 4 0 018 0z"
            ></path>
          </svg>
        </button>
      </header>

      <!-- Form Tambah Tugas Baru -->
      <form
        id="add-task-form"
        class="bg-gray-100 dark:bg-gray-800 p-6 rounded-lg shadow-xl mb-8"
      >
        <h2 class="text-2xl font-semibold mb-4">Tambah Tugas Baru</h2>
        <!-- 
          PERBAIKAN RESPONSIVE UTAMA:
          Menggunakan 'flex-wrap' untuk layout yang fleksibel.
        -->
        <div class="flex flex-wrap gap-4">
          <!-- Input Nama Tugas: 100% di HP, flex-1 di PC -->
          <input
            type="text"
            id="task-input"
            placeholder="Nama Tugas"
            class="w-full p-3 rounded-md bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white lg:flex-1"
            required
          />
          <!-- 
            Input Tanggal Deadline: 
            50% di HP (pakai calc), auto di PC 
          -->
          <input
            type="date"
            id="deadline-date-input"
            placeholder="Tanggal"
            class="w-[calc(50%-0.5rem)] p-3 rounded-md bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-500 dark:text-gray-400 lg:w-auto lg:flex-grow-0"
            title="Atur Tanggal Deadline (Opsional)"
          />
          <!-- 
            Input Jam Deadline: 
            50% di HP (pakai calc), auto di PC 
          -->
          <input
            type="time"
            id="deadline-time-input"
            placeholder="Jam"
            class="w-[calc(50%-0.5rem)] p-3 rounded-md bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-500 dark:text-gray-400 lg:w-auto lg:flex-grow-0"
            title="Atur Jam Deadline (Opsional)"
          />
          <!-- Tombol Tambah: 100% di HP, auto di PC -->
          <button
            type="submit"
            class="w-full p-3 bg-blue-600 hover:bg-blue-700 rounded-md font-semibold text-white transition-colors shadow-md lg:w-auto"
          >
            Tambah
          </button>
        </div>
      </form>

      <!-- Daftar Tugas -->
      <main>
        <!-- Kolom: Belum Dikerjakan -->
        <section id="pending-tasks">
          <h2
            class="text-2xl font-semibold mt-8 mb-4 pb-2 border-b border-gray-200 dark:border-gray-700 text-yellow-600 dark:text-yellow-400"
          >
            Belum Dikerjakan
          </h2>
          <ul id="pending-list" class="space-y-4">
            <!-- Tugas yang belum selesai akan muncul di sini -->
          </ul>
          <p
            id="pending-empty"
            class="text-gray-500 dark:text-gray-400 text-center py-4 hidden"
          >
            Yeay! Tidak ada tugas yang belum dikerjakan.
          </p>
        </section>

        <!-- Kolom: Sudah Dikerjakan -->
        <section id="completed-tasks" class="mt-12">
          <h2
            class="text-2xl font-semibold mt-8 mb-4 pb-2 border-b border-gray-200 dark:border-gray-700 text-green-600 dark:text-green-400"
          >
            Sudah Dikerjakan
          </h2>
          <ul id="completed-list" class="space-y-4">
            <!-- Tugas yang sudah selesai akan muncul di sini -->
          </ul>
          <p
            id="completed-empty"
            class="text-gray-500 dark:text-gray-400 text-center py-4 hidden"
          >
            Belum ada tugas yang selesai dikerjakan.
          </p>
        </section>
      </main>
    </div>

    <!-- 
      PERBAIKAN FOOTER:
      Dihilangkan 'fixed', 'bottom-4', 'left-4'.
      Diberi 'text-center' dan margin agar rapi di bawah.
    -->
    <footer
      class="text-center mt-12 mb-4 text-xs text-gray-400 dark:text-gray-500"
    >
      By Fiqri Albani
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- Logika Theme Toggle ---
        const themeToggleBtn = document.getElementById("theme-toggle");
        const themeIconMoon = document.getElementById("theme-icon-moon");
        const themeIconSun = document.getElementById("theme-icon-sun");
        const htmlElement = document.documentElement;

        function updateThemeIcons(isDarkMode) {
          if (isDarkMode) {
            themeIconMoon.classList.add("hidden");
            themeIconSun.classList.remove("hidden");
          } else {
            themeIconMoon.classList.remove("hidden");
            themeIconSun.classList.add("hidden");
          }
        }

        function loadTheme() {
          const storedTheme = localStorage.getItem("theme");
          const systemPrefersDark = window.matchMedia(
            "(prefers-color-scheme: dark)"
          ).matches;

          let isDark;
          if (storedTheme === "dark") {
            isDark = true;
          } else if (storedTheme === "light") {
            isDark = false;
          } else {
            isDark = systemPrefersDark;
          }

          if (isDark) {
            htmlElement.classList.add("dark");
          } else {
            htmlElement.classList.remove("dark");
          }
          updateThemeIcons(isDark);
        }

        function toggleTheme() {
          const isDark = htmlElement.classList.toggle("dark");
          if (isDark) {
            localStorage.setItem("theme", "dark");
          } else {
            localStorage.setItem("theme", "light");
          }
          updateThemeIcons(isDark);
        }

        themeToggleBtn.addEventListener("click", toggleTheme);
        loadTheme();
        // --- Akhir Logika Theme Toggle ---

        // --- Logika Manajer Tugas ---
        const taskForm = document.getElementById("add-task-form");
        const taskInput = document.getElementById("task-input");
        const deadlineDateInput = document.getElementById(
          "deadline-date-input"
        );
        const deadlineTimeInput = document.getElementById(
          "deadline-time-input"
        );
        const pendingList = document.getElementById("pending-list");
        const completedList = document.getElementById("completed-list");
        const pendingEmpty = document.getElementById("pending-empty");
        const completedEmpty = document.getElementById("completed-empty");

        let tasks = [];

        function loadTasks() {
          const tasksJSON = localStorage.getItem("tasks");
          tasks = tasksJSON ? JSON.parse(tasksJSON) : [];
          renderTasks();
        }

        function saveTasks() {
          localStorage.setItem("tasks", JSON.stringify(tasks));
        }

        function addTask(e) {
          e.preventDefault();
          const taskName = taskInput.value.trim();
          const deadlineDate = deadlineDateInput.value;
          const deadlineTime = deadlineTimeInput.value;

          if (taskName === "") {
            console.error("Nama tugas tidak boleh kosong");
            return;
          }

          let deadline = null;
          if (deadlineDate && deadlineTime) {
            deadline = `${deadlineDate}T${deadlineTime}`;
          } else if (deadlineDate) {
            deadline = deadlineDate;
          }

          const newTask = {
            id: Date.now(),
            name: taskName,
            deadline: deadline,
            completed: false,
            completedAt: null,
          };

          tasks.push(newTask);

          taskInput.value = "";
          deadlineDateInput.value = "";
          deadlineTimeInput.value = "";

          saveTasks();
          renderTasks();
        }

        function toggleTaskComplete(id) {
          const task = tasks.find((t) => t.id === id);
          if (task) {
            task.completed = !task.completed;

            if (task.completed) {
              task.completedAt = new Date().toISOString();
            } else {
              task.completedAt = null;
            }

            saveTasks();
            renderTasks();
          }
        }

        function deleteTask(id) {
          tasks = tasks.filter((t) => t.id !== id);
          saveTasks();
          renderTasks();
        }

        function formatDeadline(deadlineString) {
          if (!deadlineString) {
            return {
              text: "Tidak ada deadline",
              class: "text-gray-500 dark:text-gray-400",
            };
          }

          const hasTime = deadlineString.includes("T");
          const deadline = new Date(deadlineString);
          const today = new Date();

          let options = {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          };
          let formattedDate = "";

          if (hasTime) {
            options.hour = "2-digit";
            options.minute = "2-digit";
            options.hour12 = false;
            formattedDate = deadline.toLocaleString("id-ID", options);
          } else {
            deadline.setHours(23, 59, 59, 999);
            formattedDate = deadline.toLocaleDateString("id-ID", options);
          }

          if (deadline < today) {
            return {
              text: `TERLAMBAT (${formattedDate})`,
              class: "text-red-500 dark:text-red-400 font-bold",
            };
          } else {
            const diffMs = deadline.getTime() - today.getTime();
            const diffHours = diffMs / (1000 * 60 * 60);

            if (hasTime && diffHours < 24) {
              return {
                text: `SEGERA (${formattedDate})`,
                class: "text-yellow-500 dark:text-yellow-300 font-semibold",
              };
            }

            const isToday = deadline.toDateString() === today.toDateString();
            if (!hasTime && isToday) {
              return {
                text: `Hari Ini (${formattedDate})`,
                class: "text-yellow-500 dark:text-yellow-300 font-semibold",
              };
            }

            return {
              text: formattedDate,
              class: "text-yellow-500 dark:text-yellow-300",
            };
          }
        }

        function formatCompletionTime(isoString) {
          if (!isoString) return "";
          const date = new Date(isoString);
          const options = {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
            hour: "2-digit",
            minute: "2-digit",
            hour12: false,
          };
          return `Selesai: ${date.toLocaleString("id-ID", options)}`;
        }

        function createTaskElement(task) {
          const li = document.createElement("li");
          li.className = `bg-white dark:bg-gray-800 shadow-md p-4 rounded-lg flex flex-col sm:flex-row items-start sm:items-center justify-between transition-all duration-300 ${
            task.completed ? "opacity-60" : ""
          }`;
          li.setAttribute("data-id", task.id);

          const deadlineInfo = formatDeadline(task.deadline);
          let secondaryText = "";

          if (task.completed && task.completedAt) {
            const completionTime = formatCompletionTime(task.completedAt);
            secondaryText = `<p class="text-sm text-green-600 dark:text-green-300">${completionTime}</p>`;
          } else if (!task.completed) {
            secondaryText = `<p class="text-sm ${deadlineInfo.class}">${deadlineInfo.text}</p>`;
          }

          let contentHTML = `
            <div class="flex-grow mb-3 sm:mb-0">
                <p class="font-semibold text-lg ${
                  task.completed
                    ? "line-through text-gray-500 dark:text-gray-400"
                    : ""
                }">${task.name}</p>
                ${secondaryText}
            </div>
            <div class="flex-shrink-0 flex gap-2 w-full sm:w-auto">
                ${
                  task.completed
                    ? `
                <button class="undo-btn w-1/2 sm:w-auto text-xs py-2 px-3 rounded-full bg-yellow-600 hover:bg-yellow-700 font-medium transition-colors text-white">
                    Batal
                </button>
                `
                    : `
                <button class="complete-btn w-1/2 sm:w-auto text-xs py-2 px-3 rounded-full bg-green-600 hover:bg-green-700 font-medium transition-colors text-white">
                    Selesai
                </button>
                `
                }
                <button class="delete-btn w-1/2 sm:w-auto text-xs py-2 px-3 rounded-full bg-red-600 hover:bg-red-700 font-medium transition-colors text-white">
                    Hapus
                </button>
            </div>
          `;

          li.innerHTML = contentHTML;

          li.querySelector(".delete-btn").addEventListener("click", () =>
            deleteTask(task.id)
          );

          if (task.completed) {
            li.querySelector(".undo-btn").addEventListener("click", () =>
              toggleTaskComplete(task.id)
            );
          } else {
            li.querySelector(".complete-btn").addEventListener("click", () =>
              toggleTaskComplete(task.id)
            );
          }

          return li;
        }

        function renderTasks() {
          pendingList.innerHTML = "";
          completedList.innerHTML = "";

          const pending = tasks.filter((t) => !t.completed);
          const completed = tasks.filter((t) => t.completed);

          pending.sort((a, b) => {
            const aDeadline = a.deadline ? new Date(a.deadline) : null;
            const bDeadline = b.deadline ? new Date(b.deadline) : null;

            if (aDeadline && !a.deadline.includes("T")) {
              aDeadline.setHours(23, 59, 59, 999);
            }
            if (bDeadline && !b.deadline.includes("T")) {
              bDeadline.setHours(23, 59, 59, 999);
            }

            if (aDeadline && !bDeadline) return -1;
            if (!aDeadline && bDeadline) return 1;
            if (aDeadline && bDeadline) {
              return aDeadline - bDeadline;
            }
            return 0;
          });

          completed.sort((a, b) => {
            const aTime = a.completedAt
              ? new Date(a.completedAt).getTime()
              : b.id;
            const bTime = b.completedAt
              ? new Date(b.completedAt).getTime()
              : a.id;
            return bTime - aTime;
          });

          pendingEmpty.classList.toggle("hidden", pending.length > 0);
          completedEmpty.classList.toggle("hidden", completed.length > 0);

          pending.forEach((task) => {
            pendingList.appendChild(createTaskElement(task));
          });

          completed.forEach((task) => {
            completedList.appendChild(createTaskElement(task));
          });
        }

        // --- Inisialisasi ---
        taskForm.addEventListener("submit", addTask);
        loadTasks();
      });
    </script>
  </body>
</html>
